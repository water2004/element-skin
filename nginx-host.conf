# 主机 Nginx 配置示例
# 放置在 /etc/nginx/sites-available/element-skin 或 /etc/nginx/conf.d/element-skin.conf

# ============================================
# 方案1: 根目录部署（推荐）
# ============================================
server {
    listen 80;
    server_name yourdomain.com;

    # 前端（根目录）
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # 后端 API（根路径）
    location ~ ^/(authserver|sessionserver|admin|register|textures|static|api|me|public|docs) {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# ============================================
# 方案2: 前端子目录部署（如 /skin/）
# ============================================
# 
# 前端容器构建时设置: VITE_BASE_PATH=/skin/
# docker compose up -d --build
#
# server {
#     listen 80;
#     server_name yourdomain.com;
# 
#     # 前端（子目录 /skin/）
#     location /skin/ {
#         proxy_pass http://localhost:3000/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
# 
#     # 后端 API（根路径）
#     location ~ ^/(authserver|sessionserver|admin|register|textures|static|api|me|public|docs) {
#         proxy_pass http://localhost:8000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
# }

# ============================================
# 方案3: 前端+后端都在子目录（如 /skin/ + /skin/api/）
# ============================================
#
# 前端容器构建时设置: 
#   VITE_BASE_PATH=/skin/
#   VITE_API_BASE=/skin/api
# docker compose up -d --build
#
# 后端需要配置 root_path（在 routes_reference.py 中）：
#   app = FastAPI(root_path="/skin/api")
#
# server {
#     listen 80;
#     server_name yourdomain.com;
#
#     # 前端（子目录 /skin/）
#     location /skin/ {
#         proxy_pass http://localhost:3000/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
#
#     # 后端 API（子目录 /skin/api/）
#     location /skin/api/ {
#         proxy_pass http://localhost:8000/skin/api/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#     }
#
#     # 注意：Minecraft 客户端 authlib-injector 配置为:
#     # http://yourdomain.com/skin/api
# }
